<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tic-Tac-Toe Pro PWA</title>
    
    <link rel="manifest" href="manifest.json">
    <meta id="themeColorMeta" name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://api.dicebear.com/7.x/bottts/svg?seed=ttt&backgroundColor=0f172a">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#ef4444',
                        darkBg: '#020617',
                        lightBg: '#f8fafc'
                    },
                    animation: {
                        'pop': 'pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)',
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'zoom-in': 'zoomIn 0.3s ease-out'
                    },
                    keyframes: {
                        pop: { '0%': { transform: 'scale(0.8)', opacity: '0' }, '100%': { transform: 'scale(1)', opacity: '1' } },
                        fadeIn: { '0%': { opacity: '0', transform: 'translateY(10px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } },
                        zoomIn: { '0%': { opacity: '0', transform: 'scale(0.9)' }, '100%': { opacity: '1', transform: 'scale(1)' } }
                    }
                }
            }
        };

        (function() {
            const savedTheme = localStorage.getItem('theme_ttt') || 'dark';
            if (savedTheme === 'dark') {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        })();
    </script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior: none;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        html.dark body { background-color: #020617; color: #f1f5f9; }
        html:not(.dark) body { background-color: #f8fafc; color: #0f172a; }

        .glass {
            transition: all 0.3s ease;
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }

        html.dark .glass {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
        }

        html:not(.dark) .glass {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.05);
        }

        .board-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }

        .cell {
            aspect-ratio: 1/1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: 900;
        }

        .winning-cell {
            background: #22c55e !important;
            color: white !important;
            border-color: #22c55e !important;
        }
        
        .mode-btn.active {
            background: #3b82f6 !important;
            color: white !important;
        }

        #themeToggle {
            position: fixed !important;
            top: 1.5rem;
            right: 1.5rem;
            z-index: 9999;
            width: 3.5rem;
            height: 3.5rem;
        }

        .history-scroll::-webkit-scrollbar { width: 4px; }
        .history-scroll::-webkit-scrollbar-thumb { background: rgba(156, 163, 175, 0.3); border-radius: 10px; }

        #resultOverlay.hidden { display: none; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-start p-4 pt-24 md:pt-12 md:justify-center">

    <!-- THEME TOGGLE -->
    <button id="themeToggle" class="glass rounded-full flex items-center justify-center transition-all hover:scale-110 active:scale-90 shadow-2xl">
        <svg id="sunIcon" class="w-7 h-7 text-amber-400 hidden" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="5"></circle>
            <path d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42m12.72 12.72l1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42m12.72-12.72l1.42-1.42"></path>
        </svg>
        <svg id="moonIcon" class="w-7 h-7 text-slate-700 hidden" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
        </svg>
    </button>

    <!-- RESULT OVERLAY -->
    <div id="resultOverlay" class="fixed inset-0 z-[10000] flex items-center justify-center p-6 hidden">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm"></div>
        <div class="glass rounded-[2.5rem] w-full max-w-[280px] p-8 text-center relative z-10 animate-zoom-in">
            <div id="overlaySymbol" class="text-7xl mb-4">‚ùå</div>
            <h2 id="overlayTitle" class="text-2xl font-black uppercase tracking-tighter mb-2">Winner!</h2>
            <p id="overlaySubtitle" class="text-slate-400 text-xs font-bold uppercase tracking-widest mb-8">Player X took the lead</p>
            <button id="overlayClose" class="w-full py-4 bg-primary text-white rounded-2xl font-black uppercase text-sm tracking-widest shadow-lg shadow-primary/25 active:scale-95 transition-transform">
                Next Round
            </button>
        </div>
    </div>

    <div class="w-full max-w-sm space-y-6 animate-fade-in mb-10">
        <header class="text-center space-y-4">
            <h1 class="text-5xl font-black tracking-tighter bg-gradient-to-br from-blue-500 to-indigo-600 bg-clip-text text-transparent">
                TTT PRO
            </h1>
            
            <div class="inline-flex glass p-1.5 rounded-2xl">
                <button id="pvpBtn" class="mode-btn active px-6 py-2 rounded-xl text-xs font-bold uppercase tracking-widest transition-all">PvP</button>
                <button id="pvcBtn" class="mode-btn px-6 py-2 rounded-xl text-xs font-bold uppercase tracking-widest transition-all">vs CPU</button>
            </div>

            <div id="status" class="text-slate-500 font-bold uppercase tracking-[0.2em] text-[10px]">
                Waiting for Move...
            </div>
        </header>

        <!-- Main Stats -->
        <div class="glass rounded-[2rem] p-6 flex justify-around items-center">
            <div class="text-center">
                <div class="text-blue-500 font-black text-3xl" id="scoreX">0</div>
                <div class="text-[9px] uppercase font-black text-slate-400 tracking-widest mt-1">Player X</div>
            </div>
            <div class="h-10 w-px bg-slate-300 dark:bg-slate-700 opacity-50"></div>
            <div class="text-center">
                <div class="text-slate-400 font-black text-3xl" id="scoreDraw">0</div>
                <div class="text-[9px] uppercase font-black text-slate-400 tracking-widest mt-1">Draws</div>
            </div>
            <div class="h-10 w-px bg-slate-300 dark:bg-slate-700 opacity-50"></div>
            <div class="text-center">
                <div class="text-secondary font-black text-3xl" id="scoreO">0</div>
                <div class="text-[9px] uppercase font-black text-slate-400 tracking-widest mt-1" id="playerOTitle">Player O</div>
            </div>
        </div>

        <!-- Board Grid -->
        <div id="board" class="board-grid">
            <button class="cell glass rounded-3xl" data-index="0"></button>
            <button class="cell glass rounded-3xl" data-index="1"></button>
            <button class="cell glass rounded-3xl" data-index="2"></button>
            <button class="cell glass rounded-3xl" data-index="3"></button>
            <button class="cell glass rounded-3xl" data-index="4"></button>
            <button class="cell glass rounded-3xl" data-index="5"></button>
            <button class="cell glass rounded-3xl" data-index="6"></button>
            <button class="cell glass rounded-3xl" data-index="7"></button>
            <button class="cell glass rounded-3xl" data-index="8"></button>
        </div>

        <!-- Action Bar -->
        <div class="flex gap-4">
            <button id="resetBtn" class="flex-1 py-5 glass rounded-3xl font-black uppercase text-xs tracking-widest hover:scale-[1.02] active:scale-95 transition-all">
                Reset Board
            </button>
            <button id="clearScores" class="px-6 glass rounded-3xl hover:bg-red-500/10 active:scale-90 transition-all text-slate-400">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
            </button>
        </div>

        <!-- History Card -->
        <div class="glass rounded-[2rem] overflow-hidden">
            <div class="px-6 py-4 bg-black/5 dark:bg-white/5 flex justify-between items-center">
                <span class="text-[10px] uppercase font-black tracking-widest text-slate-400">Battle Log</span>
                <span id="roundCounter" class="text-[10px] font-black text-primary bg-primary/10 px-3 py-1 rounded-full">0 Rounds</span>
            </div>
            <div id="historyList" class="history-scroll max-h-44 overflow-y-auto px-4 py-3 space-y-3">
                <div class="text-center py-6 text-[10px] text-slate-400 font-bold uppercase tracking-widest opacity-50">Empty log</div>
            </div>
        </div>
    </div>

    <script>
        const boardArr = Array(9).fill(null);
        let currentPlayer = 'X';
        let scores = { X: 0, O: 0, draw: 0 };
        let roundHistory = [];
        let isGameActive = true;
        let isVsCpu = false;

        const cells = document.querySelectorAll('.cell');
        const statusEl = document.getElementById('status');
        const scoreXEl = document.getElementById('scoreX');
        const scoreOEl = document.getElementById('scoreO');
        const scoreDrawEl = document.getElementById('scoreDraw');
        const historyListEl = document.getElementById('historyList');
        const roundCounterEl = document.getElementById('roundCounter');
        const themeToggle = document.getElementById('themeToggle');
        const sunIcon = document.getElementById('sunIcon');
        const moonIcon = document.getElementById('moonIcon');
        
        // Overlay elements
        const overlay = document.getElementById('resultOverlay');
        const overlaySymbol = document.getElementById('overlaySymbol');
        const overlayTitle = document.getElementById('overlayTitle');
        const overlaySubtitle = document.getElementById('overlaySubtitle');
        const overlayClose = document.getElementById('overlayClose');

        const winPatterns = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];

        function syncThemeIcons() {
            const isDark = document.documentElement.classList.contains('dark');
            if (isDark) {
                sunIcon.classList.remove('hidden');
                moonIcon.classList.add('hidden');
            } else {
                sunIcon.classList.add('hidden');
                moonIcon.classList.remove('hidden');
            }
        }

        themeToggle.addEventListener('click', () => {
            const isDark = document.documentElement.classList.toggle('dark');
            localStorage.setItem('theme_ttt', isDark ? 'dark' : 'light');
            syncThemeIcons();
        });

        function handleMove(e) {
            const index = e.target.dataset.index;
            if (!isGameActive || boardArr[index] || (isVsCpu && currentPlayer === 'O')) return;
            executeMove(index);
        }

        function executeMove(index) {
            boardArr[index] = currentPlayer;
            const cell = cells[index];
            cell.innerText = currentPlayer;
            cell.classList.add('animate-pop', currentPlayer === 'X' ? 'text-primary' : 'text-secondary');
            if (navigator.vibrate) navigator.vibrate(40);

            if (checkWin()) return;
            if (checkDraw()) return;

            currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
            statusEl.innerText = isVsCpu && currentPlayer === 'O' ? "CPU Calculating..." : `Player ${currentPlayer}'s Turn`;

            if (isVsCpu && currentPlayer === 'O') setTimeout(computerMove, 700);
        }

        function computerMove() {
            if (!isGameActive) return;
            let move = findBestMove('O') || findBestMove('X') || (boardArr[4] === null ? 4 : null);
            if (move === null) {
                const avail = boardArr.map((v, i) => v === null ? i : null).filter(v => v !== null);
                move = avail[Math.floor(Math.random() * avail.length)];
            }
            if (move !== null) executeMove(move);
        }

        function findBestMove(p) {
            for (let pat of winPatterns) {
                const vals = [boardArr[pat[0]], boardArr[pat[1]], boardArr[pat[2]]];
                if (vals.filter(v => v === p).length === 2 && vals.filter(v => v === null).length === 1) {
                    return pat[vals.indexOf(null)];
                }
            }
            return null;
        }

        function showResultOverlay(result) {
            if (result === 'Draw') {
                overlaySymbol.innerText = 'ü§ù';
                overlayTitle.innerText = 'Stalemate';
                overlaySubtitle.innerText = 'A well matched battle';
            } else {
                overlaySymbol.innerText = result === 'X' ? '‚ùå' : '‚≠ï';
                overlaySymbol.className = `text-7xl mb-4 ${result === 'X' ? 'text-primary' : 'text-secondary'}`;
                overlayTitle.innerText = `${result === 'O' && isVsCpu ? 'CPU' : 'Player ' + result} Wins!`;
                overlaySubtitle.innerText = 'Absolute dominance on the grid';
            }
            overlay.classList.remove('hidden');
        }

        function checkWin() {
            for (let pat of winPatterns) {
                const [a, b, c] = pat;
                if (boardArr[a] && boardArr[a] === boardArr[b] && boardArr[a] === boardArr[c]) {
                    isGameActive = false;
                    pat.forEach(i => cells[i].classList.add('winning-cell'));
                    scores[currentPlayer]++;
                    roundHistory.unshift({ id: roundHistory.length + 1, winner: currentPlayer, mode: isVsCpu ? 'CPU' : 'PvP' });
                    updateUI();
                    statusEl.innerText = `${currentPlayer} Secured Victory`;
                    setTimeout(() => showResultOverlay(currentPlayer), 600);
                    return true;
                }
            }
            return false;
        }

        function checkDraw() {
            if (!boardArr.includes(null)) {
                isGameActive = false;
                scores.draw++;
                roundHistory.unshift({ id: roundHistory.length + 1, winner: 'Draw', mode: isVsCpu ? 'CPU' : 'PvP' });
                updateUI();
                statusEl.innerText = "Mutual Draw";
                setTimeout(() => showResultOverlay('Draw'), 600);
                return true;
            }
            return false;
        }

        function updateUI() {
            scoreXEl.innerText = scores.X;
            scoreOEl.innerText = scores.O;
            scoreDrawEl.innerText = scores.draw;
            roundCounterEl.innerText = `${roundHistory.length} Rounds`;
            
            historyListEl.innerHTML = roundHistory.map(r => `
                <div class="flex justify-between items-center bg-black/10 dark:bg-white/5 p-4 rounded-2xl animate-fade-in border border-transparent hover:border-blue-500/30 transition-all">
                    <div class="flex items-center gap-4">
                        <span class="text-[10px] font-black text-slate-500">#${r.id}</span>
                        <div class="flex flex-col items-start">
                            <span class="text-xs font-black uppercase tracking-tighter ${r.winner === 'X' ? 'text-blue-500' : r.winner === 'O' ? 'text-secondary' : 'text-slate-400'}">
                                ${r.winner === 'Draw' ? 'Stalemate' : (r.winner === 'O' && r.mode === 'CPU' ? 'CPU Dominance' : `Player ${r.winner} Win`)}
                            </span>
                            <span class="text-[8px] font-bold text-slate-500 tracking-widest uppercase">${r.mode} Battle</span>
                        </div>
                    </div>
                    <span class="text-lg">${r.winner === 'X' ? '‚ùå' : r.winner === 'O' ? '‚≠ï' : 'ü§ù'}</span>
                </div>
            `).join('') || '<div class="text-center py-6 text-[10px] text-slate-400 font-bold uppercase tracking-widest opacity-50">Empty log</div>';
            
            localStorage.setItem('ttt_pwa_data', JSON.stringify({ scores, roundHistory }));
        }

        function resetRound() {
            boardArr.fill(null);
            currentPlayer = 'X';
            isGameActive = true;
            overlay.classList.add('hidden');
            statusEl.innerText = "Waiting for Player X";
            cells.forEach(c => {
                c.innerText = '';
                c.classList.remove('winning-cell', 'text-primary', 'text-secondary', 'animate-pop');
            });
        }

        // Setup
        pvpBtn.onclick = () => { isVsCpu = false; pvpBtn.classList.add('active'); pvcBtn.classList.remove('active'); document.getElementById('playerOTitle').innerText = "Player O"; resetRound(); };
        pvcBtn.onclick = () => { isVsCpu = true; pvcBtn.classList.add('active'); pvpBtn.classList.remove('active'); document.getElementById('playerOTitle').innerText = "CPU"; resetRound(); };
        cells.forEach(c => c.onclick = handleMove);
        document.getElementById('resetBtn').onclick = resetRound;
        document.getElementById('clearScores').onclick = () => { scores = { X: 0, O: 0, draw: 0 }; roundHistory = []; updateUI(); resetRound(); };
        overlayClose.onclick = resetRound;

        window.onload = () => {
            syncThemeIcons();
            const data = JSON.parse(localStorage.getItem('ttt_pwa_data') || '{}');
            if (data.scores) scores = data.scores;
            if (data.roundHistory) roundHistory = data.roundHistory;
            updateUI();
        };
    </script>
</body>
</html>

